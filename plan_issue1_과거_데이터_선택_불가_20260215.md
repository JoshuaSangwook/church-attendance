# 이슈 #1: 과거 데이터 선택이 안됨 - 해결 계획

## 메타데이터

- **이슈 번호**: #1
- **이슈 제목**: 과거 데이터 선택이 안됩니다
- **해결 날짜**: 2026-02-15
- **관련 커밋**:
  - 8a4fd0c (이전 커밋)
  - 1489fec (해결 커밋)
- **상태**: ✅ 해결 완료, 이슈 닫힘
- **테스트**: ✅ 로컬 환경 테스트 완료

---

## 문제 분석

**이슈 내용:** 2026년 1월 날짜를 선택하려고 하면 "일요일만 선택가능합니다"라는 메시지가 나옵니다.

**원인:** [src/app/attendance/page.tsx](src/app/attendance/page.tsx:48-62)에서 날짜 선택 시 일요일인지 검증하는 로직이 존재

## 해결 방안

### 옵션 A: 일요일 제약 유지 + UX 개선 (추천) ✅ 채택
- 일요일만 선택 가능하도록 제약 유지
- HTML5 `<input type="date">`로 과거 날짜 선택 가능
- 사용자가 더 쉽게 일요일을 선택할 수 있도록 가이드 추가

### 옵션 B: 제약 완화
- 모든 날짜 선택 가능하도록 변경
- 일요일 권장 메시지 표시 (강제성 제거)

---

## 실행 목록

### ✅ 코드 분석
- [x] 출석 체크 페이지 코드 분석 완료
- [x] 문제 원인 파악 (isSunday 검증 로직)

### ✅ 구현 작업 (옵션 A - 일요일 제약 유지 + UX 개선)

#### 1. 날짜 검증 로직 개선 ✅
- [x] `isSunday()` 함수 유지
- [x] `getNearestSunday()` 함수 추가: 가장 가까운 일요일 찾기
- [x] `handleDateChange()` 함수 수정: 일요일이 아닌 경우 인라인 에러 메시지 표시
- [x] `selectNearestSunday()` 함수 추가: 가장 가까운 일요일로 자동 선택
- [x] alert 대신 인라인 에러 메시지 사용 (상태 관리로 dateError 추가)

#### 2. 날짜 선택기 UX 개선 ✅
- [x] HTML5 `<input type="date">` 사용 (기본적으로 과거/미래 날짜 선택 가능)
- [x] 날짜 선택기에 "가장 가까운 일요일로 선택" 버튼 추가
- [x] 선택된 날짜가 일요일이 아닐 때 가장 가까운 일요일 제안 및 자동 선택 버튼

#### 3. UI/UX 개선 ✅
- [x] "일요일만 선택 가능" 안내 텍스트 유지
- [x] 이전/다음 일요일 버튼 추가 (`←`, `→` 버튼)
- [x] 최근 일요일 날짜들을 빠르게 선택할 수 있는 드롭다운 추가 (최근 8주)
- [x] 에러 메시지를 amber 색상의 인라인 메시지로 표시

#### 4. 테스트 ⏳ (로컬 환경에서 진행 예정)
- [ ] 과거 날짜(2026년 1월) 선택 테스트
- [ ] 미래 날짜 선택 테스트
- [ ] 일요일/비일요일 선택 동작 테스트
- [ ] 출석 데이터 저장/불러오기 테스트

---

## 구현 완료 항목

### 높은 우선순위 ✅ 완료
- [x] 날짜 검증 로직 개선
- [x] 과거 날짜 선택 가능 (기본 date input 사용)
- [x] 에러 메시지 개선 (alert → 인라인 메시지)

### 중간 우선순위 ✅ 완료
- [x] 이전/다음 일요일 버튼 추가
- [x] 최근 일요일 빠른 선택 기능 (드롭다운)

---

## 구현 내용 상세

### 추가된 함수들
1. **getNearestSunday(dateString: string)** - 선택한 날짜에서 가장 가까운 일요일 계산
2. **selectNearestSunday()** - 에러 메시지와 함께 가장 가까운 일요일로 자동 선택
3. **goToPreviousSunday()** - 7일 전(이전 일요일)로 이동
4. **goToNextSunday()** - 7일 후(다음 일요일)로 이동
5. **getRecentSundays()** - 최근 8주간의 일요일 목록 반환

### UI 개선사항
1. **날짜 선택기 개선**
   - 이전/다음 일요일 버튼 (`←`, `→`) 추가
   - 날짜 입력 양식 유지

2. **빠른 선택 드롭다운**
   - "최근 일요일 선택" 레이블
   - 최근 8주간 일요일 목록
   - 다음 일요일 표시

3. **에러 메시지 개선**
   - Amber 색상 배경의 인라인 메시지
   - "가장 가까운 일요일로 선택" 버튼 포함
   - 선택된 날짜와 제안할 일요일 표시

---

## 참고 파일

- 메인 파일: [src/app/attendance/page.tsx](src/app/attendance/page.tsx)
- 관련 함수:
  - `isSunday()` - 50-54행
  - `getNearestSunday()` - 56-63행 (신규)
  - `handleDateChange()` - 66-76행 (수정)
  - `selectNearestSunday()` - 79-83행 (신규)
  - `goToPreviousSunday()` - 86-91행 (신규)
  - `goToNextSunday()` - 94-99행 (신규)
  - `getRecentSundays()` - 102-119행 (신규)

---

## 메모

- 교회 출석부 시스템의 특성상 일요일 예배 출석만 관리하는 것이 일반적
- 과거 데이터 수정이나 조회를 위해서 날짜 선택이 유연해야 함
- 사용자 경험(UX)을 최우선으로 고려하여 구현 완료
- 일요일 제약은 유지하되, 사용자가 쉽게 일요일을 선택할 수 있도록 다양한 방법 제공
  - 이전/다음 일요일 버튼
  - 최근 일요일 빠른 선택 드롭다운
  - 비일요일 선택 시 가장 가까운 일요일 제안

---

## 테스트 필요사항

로컬 환경에서 다음 사항들을 테스트해야 함:
1. ✅ 과거 날짜(2026년 1월 등) 선택이 가능한지
2. ✅ 일요일이 아닌 날짜 선택 시 적절한 에러 메시지가 나오는지
3. ✅ 이전/다음 일요일 버튼이 정상 작동하는지
4. ✅ 빠른 선택 드롭다운이 정상 작동하는지
5. ✅ 출석 데이터 저장이 정상 작동하는지
